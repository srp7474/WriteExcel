<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--
 @license
 Copyright (c) 2019 by Steve Pritchard of Rexcel Systems Inc.
 This file is made available under the terms of the Creative Commons Attribution-ShareAlike 3.0 license
 http://creativecommons.org/licenses/by-sa/3.0/.
 Contact: public.pritchard@gmail.com
-->

<HTML>
  <HEAD>
    <!-- gael-home-section-on
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143280098-1"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-143280098-1');
      </script>
      <link rel="icon" type="image/x-icon" href="/home/home-wrte-fav.ico">
      <title>WriteExcel Overview</title>
      <link rel=stylesheet type ="text/css" href="/home/gael-home.css" title=default>
    gael-home-section-off -->
    <TITLE>WriteExcel Overview</TITLE>
  </HEAD>
  <BODY>

<!-- gael-home-section-on

  <div>
    <div id=divHead>
      <table borders=0>
        <tr>
          <td>
            <a href=/home/gael-home.htm>
              <img id=mum-pic src=/home/img/mum-bird-pic-199x.jpg>
            </a>
          </td>
          <td>
            <div class=divTitle>WriteExcel - POI Excel Utilities
              <div class=version>
                <a href=/home/gael-home.htm>home</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <span id=verText>Version: 1.0.2</span>
              </div>
            </div>
          </td>
        </tr>
      </table>
    </div>
    <script src=/home/version.js></script>
    <div id=extract>
      <p id=extract>
        <i>This document is an extract of the Javadoc for this package found at</i> <a target=_blank href=./javadoc/index.html>WriteExcel Javadocs</a>
      </p>

gael-home-section-off -->

<h2>Overview of packages</h2>

    <!-- seems to apply thru-out when placed here -->
    <style>
      table.table    {width:500px; border-style:none;}
      table.table th {text-align:left;}
      table.table td {vertical-align:top;}
    </style>

This WriteExcel package contains classes that simplify using the Apache POI Excel interface.

The package <i>com.psec.excel</i> contain the classes that directly interface with the POI API. They wrap the org.apache.poi.ss.usermodel
found at <a target=_blank href=https://poi.apache.org/apidocs/index.html>Apache POI API</a>
<p>
The WriteExcel package uses formatted strings as the primary way of passing information to the support methods which interpret
the strings and issue the necessary POI method calls.
<p>
This utility is used in the examples of the <a target=_blank href=https://stevepritchard.ca/home/psec/psec-overview.htm>PSEC Utility Package</a>. Consequently
this distribution zip contains classes belonging to the package <i>com.psec.util</i> that are used by that interface. They are not
required to use the <i>com.psec.excel</i> package.

<h4 id=WriteExcel-desc>WriteExcel Description</h4>
<code>WriteExcel</code> creates a workbook using a simple API. One or more
<a href={@docRoot}/com/psec/excel/WriteExcel.Area.html>Area</a>
class instances are used to specify the portion of a Sheet to populate and with what.
<p>
In addition, an existing Workbook can be used as a template source so that sheets can
be copied and then left intact, modified and/or supplemented.
<p>
The creation of Workbooks containing charts is supported by using an existing Workbook as a template that
contains one or more charts and using <b>WriteExcel</b> to modify
the data that the chart refers to.
<p>
The following sample program demonstrates the ease of writing a sheet such as this sales report.
<p>
<b>Note</b>: HelloExcelNHN extends WriteExcel so that Area can be
referred to without the WriteExcel prefix.

<pre id=hungarian style="font-size:80%;display:none;">
package com.psec.run;
import  com.psec.excel.WriteExcel;

public class HelloExcel extends WriteExcel {

  public static void log(String sMsg) {System.out.println(sMsg);}
  public static Exception e(String s) {return new Exception(s); }

  WriteExcel oWE;

  public void run(String[] sArgs) throws Exception {
    log("HelloExcel writing "+sArgs[0]);
    oWE = WriteExcel.create(this,sArgs[0]);
    oWE.showNegativeAsRed();

    writeSalesSheet();

    oWE.close();
    oWE = null;
    log("HelloExcel completed writing "+sArgs[0]);
  }

  private void writeSalesSheet() throws Exception {

    String sSheet = "sample-sales";
    Area oA = oWE.createArea(sSheet,1,1)
      .header("{4.#title}Sample Sales Report")
      .header("")
      .header("Month/Unit Sales/Avg. Price/Revenue","#hdrBlue");

    String[] sMonths = "January/February/March/April/May/June/July/August/September/October/November/December".split("/");
    double[] dPrices = new double[]{10.01,11.02,15.03 ,9.04,10.05,17.06 ,22.07,23.08,14.09 ,12.10,13.11,18.12};
    int[]    nSales  = new int[]{15,61,88 ,23,-3,54 ,67,53,21 ,13,23,33};
    int[]    nQtr    = new int[]{0,0,1 ,0,0,2 ,0,0,3 ,0,0,4};

    int    nQtrSales = 0;
    double dQtrRev   = 0.0;
    int    nTotSales = 0;
    double dTotRev   = 0.0;
    for(int i=0,iMax=12; i &lt; iMax; i++) {
      oA.addRow(String.format("{:R}%s/%d/%.2f/%.2f",sMonths[i],nSales[i],dPrices[i],dPrices[i] * nSales[i]).split("/"),i+1);
      nQtrSales += nSales[i];
      dQtrRev   += dPrices[i] * nSales[i];
      nTotSales += nSales[i];
      dTotRev   += dPrices[i] * nSales[i];
      if (nQtr[i] != 0) {
        oA.addRow(String.format("{:Rb}Q%d/%d/%.2f/%.2f",nQtr[i],nQtrSales,dQtrRev / nQtrSales,dQtrRev).split("/"),"#qtr");
        nQtrSales    = 0;
        dQtrRev      = 0.0;
      }
    }
    oA.addRow(new String[0]);
    oA.addRow(String.format("{:Rb}TOTAL/%d/%.2f/%.2f",nTotSales,dTotRev / nTotSales,dTotRev).split("/"),"#TOT");
    oA.writeArea().colWidth(-1,3).addDataFilterLine();
  }
}
</pre>
<pre id=not-hungarian style="font-size:80%;">
package com.psec.run;
import  com.psec.excel.WriteExcel;

public class HelloExcelNHN extends WriteExcel {

  public static void log(String msg) {System.out.println(msg);}
  public static Exception e(String s) {return new Exception(s); }
  WriteExcel wrtExcel;

  // ---------------------- Mainline ----------------------
  public void run(String[] args) throws Exception {
    log("HelloExcel writing "+args[0]);
    wrtExcel = WriteExcel.create(this,args[0]);
    wrtExcel.setNegativeFormat(true,"");

    writeSalesSheet();

    wrtExcel.close();
    wrtExcel = null;
    log("HelloExcel completed writing "+args[0]);
  }

  private void writeSalesSheet() throws Exception {

    String sheet = "sample-sales";
    Area area = wrtExcel.createArea(sheet,1,1)
      .header("{4.#title}Sample Sales Report")
      .header("")
      .header("Month/Unit Sales/Avg. Price/Revenue","#hdrBlue");

    String[] months = "January/February/March/April/May/June/July/August/September/October/November/December".split("/");
    double[] prices = new double[]{10.01,11.02,15.03 ,9.04,10.05,17.06 ,22.07,23.08,14.09 ,12.10,13.11,18.12};
    int[]    sales  = new int[]{15,61,88 ,23,-3,54 ,67,53,21 ,13,23,33};
    int[]    qtr    = new int[]{0,0,1 ,0,0,2 ,0,0,3 ,0,0,4};

    int    qtrSales = 0;
    double qtrRev   = 0.0;
    int    totSales = 0;
    double totRev   = 0.0;
    for(int i=0,iMax=12; i &lt; iMax; i++) {
      area.addRow(String.format("{:R}%s/%d/%.2f/%.2f",months[i],sales[i],prices[i],prices[i] * sales[i]).split("/"),i+1);
      qtrSales += sales[i];
      qtrRev   += prices[i] * sales[i];
      totSales += sales[i];
      totRev   += prices[i] * sales[i];
      if (qtr[i] != 0) {
        area.addRow(String.format("{:Rb}Q%d/%d/%.2f/%.2f",qtr[i],qtrSales,qtrRev / qtrSales,qtrRev).split("/"),"#qtr");
        qtrSales    = 0;
        qtrRev      = 0.0;
      }
    }
    area.addRow(new String[0]);
    area.addRow(String.format("{:Rb}TOTAL/%d/%.2f/%.2f",totSales,totRev / totSales,totRev).split("/"),"#TOT");
    area.writeArea().colWidth(-1,3).addDataFilterLine();
  }

  public static void main(String[] args) {
    try {
      HelloExcelNHN helloExcel = new HelloExcelNHN();
      helloExcel.run(args);
    } catch (Exception e) {
      log("HelloExcel Croaked:"+e);
    }
  }
}
</pre>

<p>
produces
<p>

<img src=./images/demo-sales-report.png height=340 width=280>

<p>
Internally, WriteExcel is written using <a href=https://en.wikipedia.org/wiki/Hungarian_notation>Hungarian Notation</a>. Press
<a onClick=hungarianNotation() href=#>HUNGARIAN</a>
to view the above example
rewritten in Hungarian notation.  It produces the same results.
</p>
<script>
function hungarianNotation() {
  //console.log("turn on hungarian notation");
  var pre1 = document.getElementById("not-hungarian");
  if (pre1 != null) {
    pre1.setAttribute("style","display:none;");
  }
  var pre2 = document.getElementById("hungarian");
  if (pre2 != null) {
    pre2.setAttribute("style","font-size:80%;");
  }
}
</script>

<h4>com.psec.excel.ReadExcel</h4>
The <code>ReadExcel</code> class used to read an existing Excel Workbook and convert the cells into an array of Java objects.
<p>
The reading routines contain methods
to specify the data scope and the column filters to apply.
<p>
The objects thus created can be passed to other processing routines (including routines that employ <code>WriteExcel</code>);

<h4>CellStyle Notions and Management</h4>

Excel is fussy about whether the data matches the Cell format. <code>WriteExcel</code> inspects the data being written to a cell and classifies it as a string,
integer or number.  Numbers are further classified as to how many decimal points there are and the appropriate internal style flag of <code>nm1, num, nm3</code> or <code>nm4</code>
is applied.  This classification is used to populate the cell with the correct CellStyle format.  Furthermore, by default, integers and numbers are aligned to the right of a cell.
<p>
Numbers and integers will be shown in <span style=color:red>red</span> when they are negative if method
<a href={@docRoot}/com/psec/excel/WriteExcel.html#setNegativeFormat-boolean-java.lang.String->setNegativeFormat</a>
is called once before the first call to
<a href={@docRoot}/com/psec/excel/WriteExcel.html#createArea-java.lang.String->createArea</a>
<p>
Other cell attributes such as font size, weight or color are specified using a simple syntax described in the <a href={@docRoot}/overview-summary.html#cell-orders>CellStyle orders</a> section.
<p>
If a cell style specification populates only the background color its use will will be merged with the primary cell style to produce
a cell that is highlighted with a certain color.  The resultant combination of CellStyle objects is managed  to minimize the number of CellStyle
objects stored in the Workbook.


<h4 id=cell-orders>Cell Style Orders Syntax</h4>
The cell style is specified as a string containing an unsequenced set of case-sensitive orders. Each order can optionally be separated by one or more spaces.
<p>
The orders are:
<table class=table>
<tr><th>Order</th><th>Effect</th></tr>
<tr><td><code>b</code></td><td>bold font</td></tr>
<tr><td><code>i</code></td><td>italic font</td></tr>
<tr><td><code>s</code></td><td>strike through font</td></tr>
<tr><td><code>u</code></td><td>underline font</td></tr>
<tr><td><code>nn</code></td><td>Font size in points where nn is an integer</td></tr>
<tr><td><code>f</code></td><td>fixed font</td></tr>
<tr><td><code>l</code></td><td>Mark as link (blue, underlined)</td></tr>
<tr><td><code>-</code></td><td>Total. Single-line top border</td></tr>
<tr><td><code>~</code></td><td>Sub-Total. Double-line top border</td></tr>
<tr><td><code>=</code></td><td>Final Total. Double-line top, bottom border</td></tr>
<tr><td><code>C</code></td><td>Center text alignment</td></tr>
<tr><td><code>L</code></td><td>Left text alignment</td></tr>
<tr><td><code>R</code></td><td>Right text alignment</td></tr>
<tr><td><code>T</code></td><td>Top vertical alignment</td></tr>
<tr><td><code>M</code></td><td>Middle vertical alignment</td></tr>
<tr><td><code>B</code></td><td>Bottom vertical alignment</td></tr>
<tr><td><code>FG(r,g,b)</code></td><td>Font color specified as RGB r, g and b integers</td></tr>
<tr><td><code>BG(r,g,b)</code></td><td>Background color specified as RGB r, g and b integers.<br>When the only order,
style will be combined with other styles as the Cell is created.</td></tr>
<tr><td><code>FF(name)</code></td><td>Font family name</td></tr>
<tr><td><code>CE(str)</code></td><td>Call custom exit. <br>Used to add custom style attributes not covered by these orders.<br>
The <code>str</code> can contain a mix of alphanumeric characters as well as the &#045; or &#095; characters.<br>
The <code>str</code> value will be passed to <a href={@docRoot}/com/psec/excel/WriteExcel.html#customExit-CellStyle-java.lang.String->customExit</a>.
</td></tr>
</table>
<p>
<b>Note</b> RGB colors can also be specified as the strings defined in the
<a href=https://poi.apache.org/apidocs/4.0/org/apache/poi/ss/usermodel/IndexedColors.html target=_blank>POI IndexedColor Enum</a>.
The specified strings are folded to uppercase and the - character replaced by the _ character. For example <code>dark-green</code> is equivalent to <code>DARK_GREEN</code>.

<h4 id=style-choice>Choosing a Cell Style</h4>
The choice for a style uses several sources:
<ol>
<li>The string being inserted into the cell starts with a {...} format specifier (Specific Style).</li>
<li>The format of the data (string, integer, number) and matched according to the <a href={@docRoot}/overview-summary.html#generic-types>Generic Types</a>
or any added using XXXXXXXXXXXXXX (Data Format).</li>
<li>The
<a href={@docRoot}/com/psec/excel/WriteExcel.Area.html#addRow-java.util.ArrayList->addRow</a>

method that provided the Cell has a format specifier or a stripe specifier (Row Style)</li>
</ol>

These sources are combined according to the following rules:

<ol>
<li>The basic format is chosen according to the Data Format.</li>
<li>If a Specific Style is present, it is applied.</li>
<li>If a Row Style is present and there is no Specific Style, the Row Style is applied.</li>
<li>If a Row Style is present and it only supplies a BG color and there is not yet a BG color specified through (2) or (3), the Row Style BG Color is applied.</li>
</ol>

<h4 id=format-spec>Format Specifier Parsing</h4>
As the string for each cell being written is processed it is first inspected for at format specifier at the beginning of the string.  If found, it is parsed
according to the following rules and removed from the value written to the Cell.

<p>
<code>{[n][.]([:format]|[fmt-name])}</code>
<p>
<ol>
<li><code>n</code> specifies the number of columns to merge.  Used mostly in headings. By defualt, merged cells are centered.</li>
<li><code>.</code> required as a separator if both the merge and format are specified.</li>
<li><code>:format</code> apply the anonymous format where the string following the : is one or more <a href={@docRoot}/overview-summary.html#cell-orders>CellStyle orders</a>.</li>
<li><code>fmt-name</code> use the named format that was added with the
<a href={@docRoot}/com/psec/excel/WriteExcel.html#addStyleDefn-java.lang.String-java.lang.String->addStyleDefn</a>
method
</ol>
<p>
<b>Examples</b><p>
<code>{:bC}</code> - anonymous, Bold and center cell<br>
<code>{3.#tot}</code> - merge 3 cells and apply the #tot builtin style<br>
<code>{4}</code> - merge 4 cells, center
<p>

<h4 id=builtin-names>Built-in Style Names</h4>
The following styles are available.  They only result in CellStyle objects being added to the Workbook when they are referenced.
<p>
The ones marked <code>generic</code> are combined with the current set of <a href={@docRoot}/overview-summary.html#generic-types>Generic Types</a>.
<p>
The ones marked <code>BG color</code> are capable of adding a background to a Cell when used as a Row Specifier as described in
<a href={@docRoot}/overview-summary.html#style-choice>Choosing a Cell Style</a>.

<table class=table id=std-styles>
<tr><th>Name</th><th>Type</th><th>Orders</th><th>Usage</th></tr>
<tr><td><code>#sub</code></td><td>generic</td><td><code>-</code></td><td>Subtotal</td></tr>
<tr><td><code>#tot</code></td><td>generic</td><td><code>~</code></td><td>Total</td></tr>
<tr><td><code>#fin</code></td><td>generic</td><td><code>=</code></td><td>Final Total</td></tr>
<tr><td><code>#lnk</code></td><td>generic</td><td><code>l</code></td><td>Link</td></tr>
<tr><td><code>#lkc</code></td><td>generic</td><td><code>lC</code></td><td>Centered link</td></tr>
<tr><td><code>#evn</code></td><td>BG color</td><td><code>BG(245,255,245)</code></td><td>Even stripe</td></tr>
<tr><td><code>#odd</code></td><td>BG color</td><td><code>BG(245,245,255)</code></td><td>Odd stripe</td></tr>
<tr><td><code>#qtr</code></td><td>BG color</td><td><code>BG(255,200,145)</code></td><td>Quarter line BG color</td></tr>
<tr><td><code>#TOT</code></td><td>BG color</td><td><code>BG(255,168,80)</code></td><td>Total line BG color</td></tr>
<tr><td><code>#hdr</code></td><td>string</td><td><code>bC</code></td><td>Centered bold header</td></tr>
<tr><td><code>#hdrBlue</code></td><td>string</td><td><code>bCBG(pale-blue)</code></td><td>Pale-Blue centered bold header</td></tr>
<tr><td><code>#title</code></td><td>string</td><td><code>b16C</code></td><td>Large font title line</td></tr>
</table>

<h4 id=generic-types>Standard Data Formats</h4>
Standard types are combined with other styles at run time. The Data Formats are determined by pattern matching against the data being stored into the cell.
<p>
Data Formats can be added using the
See <a href={@docRoot}/com/psec/excel/WriteExcel.html#addDataFormat-java.lang.String-java.lang.String-java.lang.String->addDataFormat</a>
method.
<p>
The built-in generic types are:
<p>
<table class=table style="width:300px;">
  <tr><th>Name</th><th>Format</th><th>Pattern</th></tr>
  <tr><td><code>@int</code></td><td>0</td><td>^[0-9]+$</td></tr>
  <tr><td><code>@nm1</code></td><td>0.0</td><td>^[0-9][.][0-9]{1}$</td></tr>
  <tr><td><code>@num</code></td><td>0.00</td><td>^[0-9][.][0-9]{2}$</td></tr>
  <tr><td><code>@nm3</code></td><td>0.000</td><td>^[0-9][.][0-9]{3}$</td></tr>
  <tr><td><code>@nm4</code></td><td>0.0000</td><td>^[0-9][.][0-9]{4}$</td></tr>
  <tr><td><code>@str</code></td><td>null</td><td>catch all</td></tr>
</table>

See <a href={@docRoot}/com/psec/excel/WriteExcel.html#addDataFormat-java.lang.String-java.lang.String-java.lang.String->addDataFormat</a> to augment this set.


<h4>The Area class</h4>
The <a href={@docRoot}/com/psec/excel/WriteExcel.Area.html>Area</a> class instance is used to specify what parts of a Sheet are to be populated.
<p>
More than one Area can be specified for each Sheet but they should
not overlap each other.
<p>
The exception to the overlapping restriction above is the use of cells that are merged.  Provided the Area with the overlapping merge order is written last
it can overlap into previously written Areas.  This functionality is most commonly used in top of page headings.
<p>
The Area specifies the Sheet name (which is created if it does not exist when the Area is written).  It also specified the base row and column.  All
references to the row or column index with an Area are relative to base 0.
<p>
The <a href={@docRoot}/com/psec/excel/WriteExcel.Area.html#getBaseRow-->getBaseRow</a>
and
<a href={@docRoot}/com/psec/excel/WriteExcel.Area.html#getBaseCol-->getBaseCol</a>
methods will add the bias in calculating the absolute position of the row or column on the sheet.

<br>
@author Steve Pritchard Original 2019
<!-- gael-home-section-on
  </div>

<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://gael-home.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script id="dsq-count-scr" src="//gael-home.disqus.com/count.js" async></script>

<hr>
    <div id=srp-crn style='width:100%; text-align:center; margin-top:80px; border-top:1px solid rgb(151,208,255); font-size:50%;'>
      <br>
      <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">
        Powered by <b><a target=_blank href="https://stevepritchard.ca/home/gael/gael-overview.htm">GAEL (c) 2019</a></b>
      </span>
      <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">
        authored by Steve Pritchard of Rexcel Systems Inc and licensed under a
      </span>

      <br>
      <a class="c-action" rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.
      <br>
      <a class=c-action rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_US">
        <img alt="Creative Commons License" style="border-width:0; margin-right:20px;" src="http://i.creativecommons.org/l/by-sa/3.0/80x15.png" />
        <img alt="email address" style="border-width:0; margin-left:20px;" src="/home/img/email-addr.jpg" />
      </a>
    </div>

gael-home-section-off -->
  </BODY>
</HTML>
